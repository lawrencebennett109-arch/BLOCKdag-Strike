// wallet.js - MetaMask + WalletConnect (Web3Modal) integration (minimal)
const providerOptions = { walletconnect: { package: window.WalletConnectProvider.default, options: { rpc: { 1: 'https://mainnet.infura.io/v3/' } } } };
const web3Modal = new window.Web3Modal.default({ cacheProvider: false, providerOptions });
let web3Provider=null, signer=null, account=null;
async function connectMetaMask(){ if(!window.ethereum){ alert('MetaMask not found'); return; } web3Provider = new ethers.providers.Web3Provider(window.ethereum); await web3Provider.send('eth_requestAccounts', []); signer = web3Provider.getSigner(); account = await signer.getAddress(); document.getElementById('account') && (document.getElementById('account').textContent = account); }
async function connectWalletConnect(){ try { const externalProvider = await web3Modal.connect(); web3Provider = new ethers.providers.Web3Provider(externalProvider); signer = web3Provider.getSigner(); account = await signer.getAddress(); document.getElementById('account') && (document.getElementById('account').textContent = account); } catch(e) { console.error('WC connect failed', e); alert('WalletConnect failed: ' + (e.message || e)); } }
document.addEventListener('DOMContentLoaded', ()=>{ const mmBtn = document.getElementById('connect'); const wcBtn = document.getElementById('wcConnect'); if(mmBtn) mmBtn.addEventListener('click', connectMetaMask); if(wcBtn) wcBtn.addEventListener('click', connectWalletConnect); });